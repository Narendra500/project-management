generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Category {
    name            String     @map("category_name") @db.VarChar(128)
    description     String?    @map("category_description")
    color           String     @map("category_color") @db.VarChar(32)
    isDeleted       Boolean    @default(false) @map("is_deleted")
    deletedAt       DateTime?  @map("deleted_at") @db.Timestamp(6)
    createdAt       DateTime?  @default(now()) @map("created_at") @db.Timestamp(6)
    updatedAt       DateTime?  @updatedAt @map("updated_at") @db.Timestamp(6)
    uuid            String     @id @default(dbgenerated("gen_random_uuid()")) @map("category_uuid") @db.Uuid
    parentUuid      String?    @map("category_parent_uuid") @db.Uuid
    projectUuid     String?    @map("project_uuid") @db.Uuid
    parentCategory  Category?  @relation("categoriesTocategories", fields: [parentUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)
    childCategories Category[] @relation("categoriesTocategories")
    project         Project?   @relation(fields: [projectUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)
    features        Feature[]

    @@map("categories")
}

enum FeatureStatus {
    open
    inWork
    done
}

enum FeaturePriority {
    low
    medium
    high
}

model FeatureDetail {
    description        String?   @map("feature_description")
    acceptanceCriteria String?   @map("feature_acceptance_criteria")
    gitBranch          String?   @map("feature_git_branch") @db.VarChar(128)
    status             String?   @map("feature_status") @db.VarChar(20)
    dueDate            DateTime? @map("due_date") @db.Date
    priority           String?   @map("feature_priority") @db.VarChar(20)
    assigneeId         Int?      @map("assignee_id")
    featureUuid        String    @id @map("feature_uuid") @db.Uuid
    assignee           User?     @relation(fields: [assigneeId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    feature            Feature   @relation(fields: [featureUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)

    @@map("feature_details")
}

model Feature {
    name          String         @map("feature_name") @db.VarChar(128)
    isDeleted     Boolean        @default(false) @map("is_deleted")
    deletedAt     DateTime?      @map("deleted_at") @db.Timestamp(6)
    createdAt     DateTime?      @default(now()) @map("created_at") @db.Timestamp(6)
    updatedAt     DateTime?      @updatedAt @map("updated_at") @db.Timestamp(6)
    uuid          String         @id @default(dbgenerated("gen_random_uuid()")) @map("feature_uuid") @db.Uuid
    parentUuid    String?        @map("feature_parent_uuid") @db.Uuid
    categoryUuid  String?        @map("category_uuid") @db.Uuid
    details       FeatureDetail?
    categories    Category?      @relation(fields: [categoryUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)
    parentFeature Feature?       @relation("featuresTofeatures", fields: [parentUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)
    childFeatures Feature[]      @relation("featuresTofeatures")

    @@map("features")
}

model ProjectInvite {
    id          Int       @id @default(autoincrement()) @map("project_invite_id")
    inviteCode  String    @map("invite_code") @db.Uuid
    createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
    expiresAt   DateTime  @map("expires_at") @db.Timestamp(6)
    projectUuid String    @map("project_uuid") @db.Uuid
    project     Project   @relation(fields: [projectUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)

    @@map("project_invites")
}

model ProjectRole {
    id               Int           @id @default(autoincrement()) @map("project_role_id")
    name             String        @map("project_role_name") @db.VarChar(64)
    isDeleted        Boolean       @default(false) @map("is_deleted")
    deletedAt        DateTime?     @map("deleted_at") @db.Timestamp(6)
    createdAt        DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
    updatedAt        DateTime?     @updatedAt @map("updated_at") @db.Timestamp(6)
    writePermission  Boolean       @default(false) @map("write_permission")
    deletePermission Boolean       @default(false) @map("delete_permission")
    projectUuid      String        @map("project_uuid") @db.Uuid
    project          Project       @relation(fields: [projectUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)
    projectUsers     projectUser[]

    @@map("project_roles")
}

model projectUser {
    userId       Int         @map("user_id")
    roleId       Int         @map("project_role_id")
    projectUuid  String      @map("project_uuid") @db.Uuid
    project      Project     @relation(fields: [projectUuid], references: [uuid], onDelete: Cascade, onUpdate: NoAction)
    projectRoles ProjectRole @relation(fields: [roleId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "user_project_project_role_id_fkey")
    users        User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_project_user_id_fkey")

    @@id([userId, projectUuid], map: "primary_key_project_users")
    @@index([userId], map: "idx_user_project_user_id")
    @@map("project_users")
}

model Project {
    name           String          @map("project_name") @db.VarChar(128)
    description    String?         @map("project_description")
    isDeleted      Boolean         @default(false) @map("is_deleted")
    deletedAt      DateTime?       @map("deleted_at") @db.Timestamp(6)
    createdAt      DateTime?       @default(now()) @map("created_at") @db.Timestamp(6)
    updatedAt      DateTime?       @updatedAt @map("updated_at") @db.Timestamp(6)
    uuid           String          @id @default(dbgenerated("gen_random_uuid()")) @map("project_uuid") @db.Uuid
    categories     Category[]
    projectInvites ProjectInvite[]
    projectRoles   ProjectRole[]
    projectUsers   projectUser[]
    users          User[]

    @@map("projects")
}

model userEmailVerificationToken {
    userId            Int      @map("user_id")
    verificationToken String   @unique @map("verification_token") @db.VarChar(64)
    expiresAt         DateTime @default(now()) @map("expires_at") @db.Timestamp(6)
    users             User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

    @@id([userId, verificationToken])
    @@map("user_email_verification_token")
}

model User {
    id                         Int                          @id @default(autoincrement()) @map("user_id")
    name                       String                       @map("user_name") @db.VarChar(128)
    hashedPassword             String                       @map("hashed_password") @db.VarChar(128)
    isDeleted                  Boolean                      @default(false) @map("is_deleted")
    deletedAt                  DateTime?                    @map("deleted_at") @db.Timestamp(6)
    createdAt                  DateTime?                    @default(now()) @map("created_at") @db.Timestamp(6)
    updatedAt                  DateTime?                    @updatedAt @map("updated_at") @db.Timestamp(6)
    displayName                String                       @default("PleaseChangeTheDisplayName") @map("display_name") @db.VarChar(64)
    isVerified                 Boolean                      @default(false) @map("is_verified")
    activeProjectUuid          String?                      @map("active_project_uuid") @db.Uuid
    featureDetails             FeatureDetail[]
    projectMemberships         projectUser[]
    userEmailVerificationToken userEmailVerificationToken[]
    project                    Project?                     @relation(fields: [activeProjectUuid], references: [uuid], onDelete: NoAction, onUpdate: NoAction)

    @@map("users")
}
